@{
    ViewData["Title"] = "Food Delivery Financial Dashboard";
}

@section Styles {
    <!-- Material Design Icons -->
    <link href="https://cdn.jsdelivr.net/npm/@@mdi/font/css/materialdesignicons.min.css" rel="stylesheet" />

    <style>
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --success: #27ae60;
            --danger: #e74c3c;
            --warning: #f1c40f;
            --text: #2d2d2d;
            --bg: #f8f9fa;
            --card-bg: #ffffff;
        }

        body {
            background-color: var(--bg);
            margin: 0;
            font-family: "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            color: var(--text);
        }

        .dashboard {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* HEADER / FILTER SECTION */
        .header__filter {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.05);
            margin-top: 5rem;
        }

        .header__title {
            font-size: 1.75rem;
            margin-bottom: 1.2rem;
            font-weight: 600;
            color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .time-filters {
            display: flex;
            gap: 1rem;
            align-items: center;
            justify-content: center;
        }

        /* Filter Buttons */
        .filter-btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 12px;
            background: rgba(255,255,255,0.9);
            color: var(--primary);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

            .filter-btn.active {
                background: var(--accent);
                color: white;
                box-shadow: 0 4px 16px rgba(52,152,219,0.3);
            }

            .filter-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 20px rgba(0,0,0,0.08);
            }

        .date-range-picker {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

            .date-range-picker input[type="date"] {
                padding: 0.8rem;
                border-radius: 10px;
                border: 1px solid #ddd;
                background: #fff;
            }

        /* QUICK STATS */
        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-item {
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 16px;
            display: flex;
            align-items: center;
            gap: 1rem;
            box-shadow: 0 4px 24px rgba(0,0,0,0.05);
            transition: transform 0.3s ease;
        }

            .stat-item:hover {
                transform: translateY(-3px);
                box-shadow: 0 8px 30px rgba(0,0,0,0.08);
            }

            .stat-item i {
                font-size: 1.5rem;
                color: var(--accent);
            }

            .stat-item .metric-label {
                font-size: 0.9rem;
                color: #6b7280;
            }

            .stat-item .metric-value {
                font-size: 1.8rem;
                font-weight: 700;
                color: var(--primary);
            }

        /* METRICS GRID */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .metric-card {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.05);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid rgba(255,255,255,0.2);
        }

            .metric-card:hover {
                transform: translateY(-5px);
                box-shadow: 0 12px 32px rgba(0,0,0,0.1);
            }

            .metric-card::after {
                content: '';
                position: absolute;
                bottom: 0;
                left: 0;
                right: 0;
                height: 4px;
                background: linear-gradient(90deg, var(--accent) 0%, rgba(52,152,219,0.3) 100%);
            }

        .metric-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #6b7280;
            font-size: 1.1rem;
        }

            .metric-label i {
                font-size: 1.4rem;
            }

        .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            margin: 1.2rem 0;
            color: var(--primary);
        }

        .metric-trend {
            font-size: 0.9rem;
        }

        /* CHARTS CONTAINER */
        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 2rem;
            margin: 3rem 0;
        }

        .chart-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 2rem;
            border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 8px 32px rgba(0,0,0,0.05);
        }

        /* PERFORMANCE METRICS */
        .performance-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        /* DATA ACTIONS */
        .data-actions {
            display: flex;
            flex-wrap: wrap;
            justify-content: end;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .export-btn {
            background: rgba(255,255,255,0.9);
            color: var(--primary);
            padding: 1rem 2rem;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.8rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            font-size: 0.95rem;
        }

            .export-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 16px rgba(0,0,0,0.1);
            }


        /* RESPONSIVE */

        @@media (max-width: 828px) {
            .filter-btn {
                font-size: 12px;
            }

            .date-range-picker {
                font-size: 12px;
            }

                .date-range-picker input[type="date"] {
                    font-size: 12px;
                }
        }

        @@media (max-width: 768px) {
        .header__filter
        {
            flex-direction: column;
            gap: 1rem;
        }

        .header__title {
            justify-content: center;
        }

        .charts-container {
            grid-template-columns: 1fr;
        }

        .metric-value {
            font-size: 2rem;
        }

        }
    </style>
}

<!-- MAIN DASHBOARD CONTENT -->
<div class="dashboard">
    <!-- HEADER SECTION -->
    <div class="header__filter">
        <h1 class="header__title">
            <span>🍔</span>
            Food Delivery Analytics
        </h1>
        <div class="time-filters">
            <a class="filter-btn @(ViewBag.SelectedRange == "today" ? "active" : "")"
               asp-action="Qarkullimet"
               asp-route-timeRange="today">
                <i class="mdi mdi-calendar-today"></i> Today
            </a>
            <a class="filter-btn @(ViewBag.SelectedRange == "week" ? "active" : "")"
               asp-action="Qarkullimet"
               asp-route-timeRange="week">
                <i class="mdi mdi-calendar-range"></i> Week
            </a>
            <a class="filter-btn @(ViewBag.SelectedRange == "month" ? "active" : "")"
               asp-action="Qarkullimet"
               asp-route-timeRange="month">
                <i class="mdi mdi-calendar-month"></i> Month
            </a>
            <a class="filter-btn @(ViewBag.SelectedRange == "year" ? "active" : "")"
               asp-action="Qarkullimet"
               asp-route-timeRange="year">
                <i class="mdi mdi-calendar"></i> Year
            </a>
        </div>
    </div>

    <!-- MAIN METRICS GRID -->
    <div class="metrics-grid">
        <div class="metric-card">
            <div class="metric-label">
                <i class="mdi mdi-cash-multiple" style="color: var(--accent);"></i>
                Total Revenue
            </div>
            <div class="metric-value">
                €@string.Format("{0:N0}", ViewBag.TotalRevenue)
            </div>
            @{
                decimal change = ViewBag.RevenueChangePercentage ?? 0;
                string trendColor = change >= 0 ? "var(--success)" : "var(--danger)";
                string trendSymbol = change >= 0 ? "📈" : "📉";
                string trendDisplay = $"{trendSymbol} {Math.Round(change, 1)}% vs last period";
            }
            <div class="metric-trend" style="color: @trendColor;">
                @trendDisplay
            </div>
        </div>

        <div class="metric-card">
            <div class="metric-label">
                <i class="mdi mdi-checkbox-marked-circle" style="color: var(--success);"></i>
                Completed Orders
            </div>
            <div class="metric-value">@ViewBag.CompletedOrders</div>
            <div class="metric-trend" style="color: var(--success);">
                📊 High success rate
            </div>
        </div>

        <div class="metric-card">
            <div class="metric-label">
                <i class="mdi mdi-close-circle" style="color: var(--danger);"></i>
                Canceled Orders
            </div>
            <div class="metric-value">@ViewBag.CanceledOrders</div>
            <div class="metric-trend" style="color: var(--danger);">
                📉 Potential losses
            </div>
        </div>
    </div>

    <!-- ADVANCED CHARTS CONTAINER -->
    <div class="charts-container">
        <div class="chart-card">
            <canvas id="revenueChart"></canvas>
        </div>
        <div class="chart-card">
            <canvas id="orderTrendChart"></canvas>
        </div>
    </div>

    <!-- PERFORMANCE METRICS -->
    <div class="performance-metrics">
        <div class="metric-card">
            <div class="metric-label">
                <i class="mdi mdi-food"></i>
                Top Selling Item
            </div>
            <div class="metric-value">@ViewBag.TopItemName</div>
            <div class="metric-trend">
                🔥 Sold @ViewBag.TopItemQty times
            </div>
        </div>

        <div class="metric-card">
            <div class="metric-label">
                <i class="mdi mdi-motorbike"></i>
                Delivery Time Average
            </div>
            <div class="metric-value">
                @if (ViewBag.DeliveryPerformancePercent != "N/A")
                {
                    <span>⏳ Avg: @ViewBag.DeliveryPerformancePercent</span>
                }
                else
                {
                    <span style="color: var(--danger); font-size: 1rem;">⚠️ No Completed Orders</span>
                }
            </div>
            <div class="metric-trend">
                @if (ViewBag.FastestDelivery != "N/A")
                {
                    <span>🚀 Fastest Delivery: @ViewBag.FastestDelivery</span>
                }
                else
                {
                    <span>⏱️ Waiting for first completed orders</span>
                }
            </div>
        </div>

    </div>

    <!-- DATA ACTIONS -->
    <div class="data-actions">
        <!-- EXPORT EXCEL -->
        <button class="export-btn" onclick="exportReport()">
            <i class="mdi mdi-file-export"></i> Export Report
        </button>

        <!-- PRINT PDF -->
        <button class="export-btn" style="background: var(--danger); color: #fff;" onclick="printReport()">
            <i class="mdi mdi-printer"></i> Print
        </button>
    </div>
</div>

@section Scripts {
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // REVENUE CHART
        const revenueLabels = @Html.Raw(ViewBag.LabelsJson ?? "[]");
        const revenueData   = @Html.Raw(ViewBag.DataJson ?? "[]");

        // ORDER TREND CHART
        const trendLabels = @Html.Raw(ViewBag.OrderTrendLabelsJson ?? "[]");
        const trendData   = @Html.Raw(ViewBag.OrderTrendDataJson ?? "[]");

        const initCharts = () => {
            // 1) Revenue Chart
            new Chart(document.getElementById('revenueChart'), {
                type: 'line',
                data: {
                    labels: revenueLabels,
                    datasets: [{
                        label: 'Revenue',
                        data: revenueData,
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52,152,219,0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });

            // 2) Order Trend Chart
            new Chart(document.getElementById('orderTrendChart'), {
                type: 'bar',
                data: {
                    labels: trendLabels,
                    datasets: [{
                        label: 'Orders by Time',
                        data: trendData,
                        backgroundColor: '#3498db'
                    }]
                },
                options: {
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        };

        var currentTimeRange = '@ViewBag.SelectedRange';
   
             function exportReport() {
             window.location.href = '/Admin/ExportReport?timeRange=' + currentTimeRange;
        }

        function printReport() {
             window.location.href = '/Admin/GeneratePdfReport?timeRange=' + currentTimeRange;
        }

        document.addEventListener('DOMContentLoaded', initCharts);
    </script>
}
